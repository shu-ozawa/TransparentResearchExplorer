# フロントエンドドキュメント

このドキュメントは、Transparent Research Explorerアプリケーションのフロントエンドアーキテクチャ、コンポーネント、状態管理、API連携、およびデータフローの概要を提供します。

## 全体のアーキテクチャ

フロントエンドはReactを使用して構築されています。アプリケーションのメインエントリーポイントは`frontend/src/App.js`です。

-   **`App.js`**: このファイルはメインのアプリケーション構造をセットアップします。`Header`、`MainContent`、`Footer`などの共通コンポーネントをレンダリングして全体のレイアウトを定義します。また、`frontend/src/contexts/AppContext.js`の`AppProvider`でアプリケーション全体をラップし、グローバル状態をすべてのネストされたコンポーネントからアクセス可能にします。
-   **`frontend/src/pages/HomePage.js`**: これはアプリケーションのメインページです。キーワード入力フォーム、クエリ生成のトリガー、クエリツリーの可視化など、主要なユーザー向け機能を統括します。

## コンポーネント

アプリケーションの再利用可能なUI要素は、主に`frontend/src/components/`ディレクトリにあるコンポーネントとして整理されています。

-   **`QueryInputForm.js`**: このコンポーネントは、ユーザーが初期キーワードや研究テーマを入力できるフォームをレンダリングします。送信時に、入力されたキーワードと共に`onSubmit`ハンドラー（親コンポーネントの`HomePage.js`から提供）を呼び出します。
-   **`PaperCard.js`**: このコンポーネントは、研究論文の詳細情報をカード形式で表示するように設計されています。タイトル、著者、要約、関連性スコア、カテゴリなどの詳細を含む`paper`オブジェクトをプロップとして受け取ります。また、「詳細」、「選択」、「PDF」などのアクションボタンも含まれています。
    -   *注意*: 現在、`HomePage.js`には`PaperCard.js`からエクスポートされた`PaperCardWithDummyData`が含まれており、これは事前定義されたダミーデータで`PaperCard`をレンダリングします。これは、ユーザーのクエリやインタラクションに応じてバックエンドから取得した実際の論文データを表示することを意図していることを示唆しています。
-   **`QueryTreeVisualizer.js`**: このコンポーネントは階層的なクエリツリー構造のレンダリングを担当します。D3.jsライブラリを使用してインタラクティブなSVG可視化を作成します。プロップとして`data`（ツリー構造）を受け取り、ズーム機能を提供します。
-   **レイアウトコンポーネント**:
    -   **`Header.js`**: アプリケーションのヘッダーをレンダリングし、通常はアプリケーションのタイトルやブランディングを含みます。
    -   **`Footer.js`**: アプリケーションのフッターをレンダリングし、著作権情報やセカンダリリンクによく使用されます。
    -   **`MainContent.js`**: 任意のページのメインコンテンツ領域を囲むラッパーコンポーネントで、一貫したレイアウトを確保します。
-   **`ExampleComponent.js`**: このコンポーネントはプレースホルダーまたは初期開発とテスト用のコンポーネントのように見えます。おそらくMaterial UIの統合を検証するために使用されています。アラートアクションを持つシンプルなボタンが含まれています。これはコアの本番機能の一部ではないかもしれません。

## 状態管理

アプリケーションはグローバルとローカルの状態管理を組み合わせて使用しています。

-   **`AppContext.js` (`frontend/src/contexts/AppContext.js`)**:
    -   このファイルはReactのContext APIを使用してグローバル状態管理のための`AppContext`と`AppProvider`を定義します。
    -   `AppProvider`は`data`状態変数とそれを更新する`setData`関数を初期化します。
    -   **使用目的**: `AppContext`は、明示的なプロップドリリングなしに様々なコンポーネント間で共有する必要があるデータ（例：ユーザー認証状態、アプリケーション全体の設定、またはグローバルにアクセス可能なクエリ結果など）を保持するように設計されています。
    -   **現在の統合**: `AppProvider`は`App.js`でアプリケーションをラップしていますが、提供するグローバルな`data`状態は、現在のレビューされたコンポーネントの実装では積極的に使用されていないようです。将来の使用のためのインフラストラクチャが整っています。
-   **ローカルコンポーネント状態（`useState`）**:
    -   個々のコンポーネントは`useState`フックを使用して独自の内部状態を管理します。
    -   例えば、`QueryInputForm.js`は`useState`を使用してキーワード入力フィールドの値（`initialKeywords`）を管理します。
    -   `HomePage.js`は`useState`を使用してAPIから取得した`queryTreeData`を保存・管理し、それを`QueryTreeVisualizer`に渡します。

## API連携

バックエンドサーバーとのすべての通信は`frontend/src/services/apiService.js`モジュール内に集中化されています。

-   **`apiService.js`**: このサービスはAPIコールを行うメソッドを含むオブジェクトをエクスポートします。
    -   **`generateQuery(initialKeywords)`**:
        -   `/api/generate`エンドポイントに`POST`リクエストを送信します。
        -   リクエストボディには`{ initial_keywords: initialKeywords }`が含まれます。
        -   **目的**: この関数は、ユーザーの研究テーマ/キーワードをバックエンドに送信するために使用され、バックエンドはそれを処理してメインクエリと、潜在的な関連サブクエリまたは検索結果を生成します。
    -   **`fetchQueryTreeData()`**:
        -   `/api/queries/tree`エンドポイントに`GET`リクエストを送信します。
        -   **目的**: この関数は、クエリ間の関係（例：初期クエリとその洗練されたバージョンや関連概念）を表す階層的なデータ構造を取得するために使用されます。このデータは`QueryTreeVisualizer`コンポーネントによって使用されます。
    -   このサービスには、汎用的な`fetchData(endpoint)`関数とネットワークレスポンスの基本的なエラーハンドリングも含まれています。

## データフロー

以下は、フロントエンド内の典型的な操作とデータの移動のシーケンスを説明しています：

1.  **キーワード入力**:
    -   ユーザーは`HomePage.js`でレンダリングされた`QueryInputForm`に研究キーワードを入力します。
2.  **クエリ生成リクエスト**:
    -   フォームを送信すると、`QueryInputForm`の`onSubmit`ハンドラーは`HomePage.js`の`handleKeywordsSubmit`関数を呼び出します。
    -   `handleKeywordsSubmit`は提供されたキーワードで`apiService.generateQuery()`を呼び出します。
3.  **`generateQuery`結果の処理**:
    -   バックエンドはリクエストを処理し、レスポンス（例：元のクエリと関連クエリのリストを含む）を返します。
    -   **現在の処理**: `HomePage.js`の現在の実装では、`generateQuery`からの結果はコンソールにログ出力され、ブラウザの`alert()`を通じてユーザーに表示されます。
    -   **使用目的**: このデータの意図された使用法は、アプリケーションの状態を更新し、生成されたクエリをUIでより効果的に表示し、潜在的に研究論文のリスト（`PaperCard`を使用）を表示したり、`QueryTreeVisualizer`を更新したりすることでしょう。
4.  **クエリツリーデータの取得**:
    -   `HomePage.js`には「クエリツリーを読み込む」ボタンが含まれています。クリックすると、`loadQueryTreeData`関数がトリガーされます。
    -   `loadQueryTreeData`は`apiService.fetchQueryTreeData()`を呼び出します。
5.  **クエリツリーの可視化**:
    -   `apiService.fetchQueryTreeData()`から返されたデータ（階層的なJSONオブジェクトであるべき）は`HomePage.js`内の`queryTreeData`状態変数に保存されます。
    -   この`queryTreeData`は`QueryTreeVisualizer.js`コンポーネントにプロップとして渡されます。
    -   `QueryTreeVisualizer`はD3.jsを使用してこのデータをインタラクティブなツリー図としてレンダリングします。
6.  **論文情報の表示**:
    -   `PaperCard.js`コンポーネントは個々の研究論文の詳細を表示するように設計されています。
    -   現在は`HomePage.js`で`PaperCardWithDummyData`を使用して、静的なハードコードされた論文情報を表示しています。
    -   **意図された目的**: 完全に機能するアプリケーションでは、論文データはバックエンドから取得され（おそらく`generateQuery`レスポンスの一部として、またはユーザーのクエリとのインタラクションに基づく別個のAPIコールを通じて）、`PaperCard`コンポーネントの複数のインスタンスを使用して動的にレンダリングされるでしょう。
---
